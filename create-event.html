<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Event - OpporLink Host</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(to bottom, #e8f0f8 0%, #f5f9fc 100%);
            min-height: 100vh;
        }

        .navbar {
            background-color: #1a1f2e;
            color: white;
            padding: 12px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            color: white;
        }

        .logo svg {
            width: 24px;
            height: 24px;
        }

        .host-badge {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .page-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px 40px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            padding: 32px;
        }

        .card-header {
            margin-bottom: 24px;
        }

        .card-header h1 {
            font-size: 24px;
            color: #1a1f2e;
            margin-bottom: 6px;
        }

        .card-header p {
            font-size: 14px;
            color: #6b7280;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #1a1f2e;
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #d5dde6;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #4c8bf5;
            box-shadow: 0 0 0 3px rgba(76, 139, 245, 0.15);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .muted {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 4px;
        }

        .mode-toggle {
            display: flex;
            gap: 16px;
            margin-top: 4px;
        }

        .mode-toggle label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            cursor: pointer;
        }

        .mode-toggle input[type="radio"] {
            accent-color: #4c8bf5;
        }

        .btn-row {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 12px;
        }

        .btn {
            padding: 11px 22px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #4c8bf5;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3b7ae0;
            box-shadow: 0 4px 12px rgba(76, 139, 245, 0.3);
        }

        .btn-secondary {
            background-color: white;
            color: #4b5563;
            border: 1px solid #d5dde6;
        }

        .btn-secondary:hover {
            background-color: #f8fafc;
        }

        .status-message {
            font-size: 14px;
            margin-top: 12px;
            display: none;
        }

        .status-message.success {
            color: #059669;
        }

        .status-message.error {
            color: #dc2626;
        }

        @media (max-width: 768px) {
            .card {
                padding: 24px 18px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- API Configuration -->
    <script src="api-config.js"></script>

    <nav class="navbar">
        <a class="logo" href="index.html">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
            </svg>
            OpporLink
        </a>
        <span class="host-badge">Host workspace</span>
    </nav>

    <div class="page-container">
        <div class="card">
            <div class="card-header">
                <h1>Create a new event</h1>
                <p>Fill in the details below to host a hackathon, workshop, or meetup for students.</p>
            </div>

            <form id="createEventForm">
                <div class="form-group">
                    <label for="title">Event title</label>
                    <input type="text" id="title" required placeholder="e.g. Campus Hackfest 2026">
                </div>

                <div class="form-group">
                    <label for="description">Short description</label>
                    <textarea id="description" required placeholder="What is this event about?"></textarea>
                    <div class="muted">This is shown on the main events page.</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="date">Event date</label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-group">
                        <label for="time">Start time</label>
                        <input type="time" id="time" required>
                    </div>

                    <div class="form-group">
                        <label for="type">Event type</label>
                        <select id="type" required>
                            <option value="Hackathon">Hackathon</option>
                            <option value="Workshop">Workshop</option>
                            <option value="Webinar">Webinar</option>
                            <option value="Meetup">Meetup</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Mode</label>
                        <div class="mode-toggle">
                            <label>
                                <input type="radio" name="mode" value="online" checked>
                                Online
                            </label>
                            <label>
                                <input type="radio" name="mode" value="offline">
                                Offline (in-person)
                            </label>
                        </div>
                        <div class="muted">If offline, you will be asked for a venue.</div>
                    </div>

                    <div class="form-group" id="onlineLinkGroup">
                        <label for="onlineLink">Online meeting link (optional)</label>
                        <input type="text" id="onlineLink" placeholder="e.g. Zoom / Google Meet link">
                    </div>

                    <div class="form-group" id="venueGroup" style="display: none;">
                        <label for="venue">Venue (offline)</label>
                        <input type="text" id="venue" placeholder="e.g. Block A, Seminar Hall 2">
                    </div>

                    <div class="form-group">
                        <label for="maxParticipants">Maximum participants</label>
                        <input type="number" id="maxParticipants" min="1" value="100" required>
                    </div>

                    <div class="form-group">
                        <label for="prize">Prize / perks (optional)</label>
                        <input type="text" id="prize" placeholder="e.g. â‚¹10,000 cash prize + swag">
                    </div>

                    <div class="form-group">
                        <label for="difficulty">Difficulty</label>
                        <select id="difficulty" required>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate" selected>Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="category">Category / domain</label>
                        <input type="text" id="category" placeholder="e.g. AI/ML, Web Dev, Design">
                    </div>
                </div>

                <div class="form-group">
                    <label for="registrationDeadline">Registration deadline</label>
                    <input type="date" id="registrationDeadline">
                    <div class="muted">If empty, registration will be open till the event date.</div>
                </div>

                <div class="form-group">
                    <label for="requiredSkills">Required skills (comma separated)</label>
                    <input type="text" id="requiredSkills" placeholder="e.g. React, Figma, Python">
                </div>

                <div class="btn-row">
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='index.html'">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" id="createBtn">
                        Create event
                    </button>
                </div>

                <div id="statusMessage" class="status-message"></div>
            </form>
        </div>
    </div>

    <script>
        // Simple auth + role guard
        (function guardHostPage() {
            const token = localStorage.getItem("token");
            const role = localStorage.getItem("userRole");
            if (!token) {
                window.location.href = "login.html";
                return;
            }
            if (role && role !== "host") {
                // Logged in but not marked as host; send them back to main site
                window.location.href = "index.html";
            }
        })();

        // Toggle venue / online link visibility
        const onlineLinkGroup = document.getElementById("onlineLinkGroup");
        const venueGroup = document.getElementById("venueGroup");
        const modeInputs = document.querySelectorAll('input[name="mode"]');

        modeInputs.forEach((input) => {
            input.addEventListener("change", () => {
                if (input.checked && input.value === "offline") {
                    venueGroup.style.display = "block";
                    onlineLinkGroup.style.display = "none";
                } else if (input.checked && input.value === "online") {
                    venueGroup.style.display = "none";
                    onlineLinkGroup.style.display = "block";
                }
            });
        });

        // Helper: show status
        function showStatus(message, type) {
            const el = document.getElementById("statusMessage");
            el.textContent = message;
            el.className = "status-message " + (type || "");
            el.style.display = "block";
        }

        // Create event handler
        document.getElementById("createEventForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const createBtn = document.getElementById("createBtn");
            createBtn.disabled = true;
            createBtn.textContent = "Creating...";
            showStatus("", "");

            const title = document.getElementById("title").value.trim();
            const description = document.getElementById("description").value.trim();
            const date = document.getElementById("date").value;
            const time = document.getElementById("time").value;
            const type = document.getElementById("type").value;
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const onlineLink = document.getElementById("onlineLink").value.trim();
            const venue = document.getElementById("venue").value.trim();
            const maxParticipants = parseInt(document.getElementById("maxParticipants").value || "0", 10);
            const prize = document.getElementById("prize").value.trim();
            const difficulty = document.getElementById("difficulty").value;
            const category = document.getElementById("category").value.trim();
            const registrationDeadline = document.getElementById("registrationDeadline").value;
            const requiredSkillsRaw = document.getElementById("requiredSkills").value.trim();

            if (!title || !description || !date || !time || !maxParticipants) {
                showStatus("Please fill in all required fields.", "error");
                createBtn.disabled = false;
                createBtn.textContent = "Create event";
                return;
            }

            if (mode === "offline" && !venue) {
                showStatus("Please provide a venue for offline events.", "error");
                createBtn.disabled = false;
                createBtn.textContent = "Create event";
                return;
            }

            const eventDate = new Date(date + "T" + (time || "00:00")).toISOString();
            let regDeadlineIso = null;
            if (registrationDeadline) {
                regDeadlineIso = new Date(registrationDeadline + "T23:59:59").toISOString();
            }

            const requiredSkills = requiredSkillsRaw
                ? requiredSkillsRaw.split(",").map((s) => s.trim()).filter(Boolean)
                : [];

            const payload = {
                title,
                description,
                type,
                mode,
                eventDate,
                location: mode === "offline" ? venue : onlineLink || "Online",
                maxParticipants,
                prize: prize || undefined,
                difficulty,
                category: category || undefined,
                registrationDeadline: regDeadlineIso || undefined,
                requiredSkills
            };

            try {
                const token = localStorage.getItem("token");
                if (!token) {
                    window.location.href = "login.html";
                    return;
                }

                const resp = await fetch(`${API_BASE_URL}/api/events`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });

                const result = await resp.json().catch(() => ({}));

                if (!resp.ok || (result && result.success === false)) {
                    const msg = (result && (result.error || result.message)) || "Failed to create event.";
                    throw new Error(msg);
                }

                showStatus("Event created successfully! Redirecting to home...", "success");

                setTimeout(() => {
                    window.location.href = "index.html";
                }, 800);
            } catch (err) {
                console.error(err);
                showStatus(err.message || "Something went wrong while creating the event.", "error");
                createBtn.disabled = false;
                createBtn.textContent = "Create event";
            }
        });
    </script>
</body>
</html>

