<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login to Ascendify</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(to bottom, #e8f0f8 0%, #f5f9fc 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .navbar {
            background-color: #1a1f2e;
            color: white;
            padding: 12px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            color: white;
        }

        .logo svg {
            width: 24px;
            height: 24px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .login-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            width: 100%;
            max-width: 420px;
            padding: 40px;
            margin-top: 80px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            font-size: 28px;
            color: #1a1f2e;
            margin-bottom: 8px;
        }

        .login-header p {
            color: #6b7280;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #1a1f2e;
            margin-bottom: 8px;
        }

        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #d5dde6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="email"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #4c8bf5;
            box-shadow: 0 0 0 3px rgba(76, 139, 245, 0.1);
        }

        .btn {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #4c8bf5;
            color: white;
            margin-bottom: 12px;
        }

        .btn-primary:hover {
            background-color: #3b7ae0;
            box-shadow: 0 4px 12px rgba(76, 139, 245, 0.3);
        }

        .btn-primary:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .btn-google {
            background-color: white;
            color: #1a1f2e;
            border: 1px solid #d5dde6;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-google:hover {
            background-color: #f8fafc;
            border-color: #4c8bf5;
        }

        .google-icon {
            width: 18px;
            height: 18px;
        }

        .divider {
            text-align: center;
            margin: 24px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: #e5e7eb;
            z-index: 0;
        }

        .divider span {
            background-color: white;
            padding: 0 12px;
            color: #9ca3af;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }

        .signup-link {
            text-align: center;
            margin-top: 24px;
        }

        .signup-link p {
            color: #6b7280;
            font-size: 14px;
        }

        .signup-link a {
            color: #4c8bf5;
            text-decoration: none;
            font-weight: 600;
        }

        .signup-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #dc2626;
            font-size: 14px;
            margin-top: 6px;
            display: none;
        }

        .success-message {
            color: #059669;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
            text-align: center;
        }

        .loading {
            display: none;
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <!-- API Configuration -->
    <script src="api-config.js"></script>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <a class="logo" href="index.html">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
            </svg>
            Ascendify
        </a>
        <div class="nav-right"></div>
    </nav>

    <!-- Login Container -->
    <div class="login-container">
        <div class="login-header">
            <h1>Login to Ascendify</h1>
            <p>Access your account and explore opportunities</p>
        </div>

        <div class="success-message" id="successMessage">Logging in...</div>

        <!-- Email Login Form -->
        <form id="loginForm" onsubmit="handleEmailLogin(event)">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="your@email.com" required>
                <div class="error-message" id="emailError"></div>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
                <div class="error-message" id="passwordError"></div>
            </div>

            <button type="submit" class="btn btn-primary" id="loginButton">Login</button>
            <div class="error-message" id="formError"></div>
            <div class="loading" id="loading">Logging in...</div>
        </form>

        <!-- Divider -->
        <div class="divider">
            <span>or</span>
        </div>

        <!-- Google Login -->
        <button class="btn btn-google" id="googleLoginBtn">
            <svg class="google-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
            </svg>
            Sign in with Google
        </button>

        <!-- Signup Link -->
        <div class="signup-link">
            <p>Don't have an account? <a href="signup.html">Create Account</a></p>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {
            getAuth,
            signInWithPopup,
            GoogleAuthProvider,
            signInWithEmailAndPassword,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDl8_zv0b2QRM8FA6kUhMrwfzLx4ZU2HEE",
            authDomain: "ascendify-auth-6e1b2.firebaseapp.com",
            projectId: "ascendify-auth-6e1b2",
            storageBucket: "ascendify-auth-6e1b2.firebasestorage.app",
            messagingSenderId: "1098866720931",
            appId: "1:1098866720931:web:070e93d16fb09801c43f16",
            measurementId: "G-3K0TPPCJQB"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // FIXED: Do not auto-redirect from login page. Let user choose to go back if they prefer.
        // Users can navigate back to index.html manually or use browser back button
        // This prevents unwanted redirects and allows users to re-login if needed
        let userCheckDone = false;
        
        // Just check auth state, don't redirect
        onAuthStateChanged(auth, (user) => {
            userCheckDone = true;
            // User can manually navigate away if already logged in
            // No auto-redirect to prevent confusing behavior
        });

        // Email Login Handler
        window.handleEmailLogin = async (event) => {
            event.preventDefault();

            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const formError = document.getElementById("formError");
            const loading = document.getElementById("loading");
            const loginButton = document.getElementById("loginButton");
            const successMessage = document.getElementById("successMessage");

            formError.style.display = "none";
            loading.style.display = "block";
            loginButton.disabled = true;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const token = await userCredential.user.getIdToken();

                localStorage.setItem("token", token);
                localStorage.setItem("userEmail", userCredential.user.email);

                successMessage.style.display = "block";
                successMessage.textContent = "Login successful! Redirecting...";

                setTimeout(() => {
                    window.location.href = "index.html";
                }, 500);
            } catch (error) {
                loading.style.display = "none";
                loginButton.disabled = false;

                if (error.code === "auth/user-not-found") {
                    formError.textContent = "No account found with this email.";
                } else if (error.code === "auth/wrong-password") {
                    formError.textContent = "Incorrect password.";
                } else if (error.code === "auth/invalid-email") {
                    formError.textContent = "Invalid email address.";
                } else if (error.code === "auth/too-many-requests") {
                    formError.textContent = "Too many failed attempts. Please try again later.";
                } else {
                    formError.textContent = error.message;
                }
                formError.style.display = "block";
            }
        };

        // Google Login Handler
        document.getElementById("googleLoginBtn").addEventListener("click", async () => {
            const googleProvider = new GoogleAuthProvider();
            const loginButton = document.getElementById("googleLoginBtn");
            const formError = document.getElementById("formError");
            const loading = document.getElementById("loading");
            const successMessage = document.getElementById("successMessage");

            formError.style.display = "none";
            loading.style.display = "block";
            loginButton.disabled = true;

            try {
                const result = await signInWithPopup(auth, googleProvider);
                const token = await result.user.getIdToken();

                localStorage.setItem("token", token);
                localStorage.setItem("userEmail", result.user.email);

                successMessage.style.display = "block";
                successMessage.textContent = "Login successful! Redirecting...";

                setTimeout(() => {
                    window.location.href = "index.html";
                }, 500);
            } catch (error) {
                loading.style.display = "none";
                loginButton.disabled = false;

                if (error.code !== "auth/popup-closed-by-user") {
                    formError.textContent = error.message;
                    formError.style.display = "block";
                }
            }
        });
    </script>
</body>
</html>
